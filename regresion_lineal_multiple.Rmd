---
title: 'Actividad 2: Mod. Estad. para la Toma Decisiones'
author: "Cristian Sarmiento"
date: "2024-08-28"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(paqueteMETODOS)
library(lmtest)
library(stargazer)
library(dplyr)
library(mice)
library(visdat)
library(plotly)
library(reshape2)
data(vivienda)
```

### 1.1. Introducción
El presente informe busca comprender los factores que determinan el precio de una vivienda con ciertas características definidas. De esta forma, la idea es adentrarse en el análisis del precio de viviendas en las zonas norte y sur dependiendo de las necesidades concretas del cliente.

A través de un conjunto de datos denominado "vivienda", que tien información detallada sobre diversas viviendas, este estudio busca identificar la relación entre el precio de la vivienda y las variables de área construida, estrato, número de cuartos, número de parqueaderos, número de baños mediante un modelo de regresión múltiple.

### 1.2. Metodología
Para alcanzar los objetivos planteados, se empleará la siguiente metodología:

- *Análisis exploratorio de datos:* Se explorarán los datos del conjunto "vivienda" para comprender su distribución, identificar posibles valores atípicos y visualizar la relación entre las variables de interés (precio, área construida, estrato, número de cuartos, número de parqueaderos, número de baños).
- *Modelado estadístico:* Se aplicará modelo de regresión lineal míltiple para identificar el que mejor se ajuste a los datos y explique la relación entre el precio y las variables en mención.
- *Evaluación del modelo:* Se evaluará el rendimiento de cada modelo estadístico utilizando métricas adecuadas, como el coeficiente de determinación (R²) y la validación de supuestos estadísticos.

### 1.3. Resultados
De acuerdo al estudio realizado, la relación entre el precio de una vivienda estrato 4 en Cali y su área construida, según análisis descriptivos proporcionados en los anexos demuestran una relación positiva y creciente. Lo cual tiene sentido en tanto que a mayor tamaño de vivienda, se espera que su precio sea mayor. El modelo estadístico de regresión lineal simple permitió ajustar el precio de una vivienda con mayor precisión en función de su tamaño, facilitando la toma de decisiones informadas en el mercado inmobiliario local. En la gráfica que se muestra a continuación se puede evidenciar cómo están relacionados los datos y el modelo aplicado sobre los apartamentos de estrato 4 dentro de los datos de muestra:

```{r echo=FALSE}
```
El en gráfico propuesto se da a conocer gráficamente la relación entre las dos variables de estudio. Como se esperaba, los datos presentan una relación creciente positiva, el modelo propuesto que permite conocer el impacto de cuánto puede llegar a crecer el precio en función del área de un bien. El modelo de regresión lineal sencillo se realizó usando como variable dependiente el precio en millones y el área construida en metros cuadrados como variable independiente o explicativa. Los datos sobre el modelo de regresión utilizado se pueden encontrar en la siguiente tabla:

``` {r echo=FALSE}
# stargazer(modelo_regresion, type = "text")
```

Sobre el modelo de regresión simple, se puede interpretar que el 71.63% de la variabilidad en la variable dependiente (precio en millones) está explicada por la variable independiente (area construida en metros cuadrados). Esto significa que el modelo propuesto captura una porción considerable de la variabilidad en el precio que puede ser atribuida a la relación con el área de construcción de una propiedad. Además, con base en el análisis de los estadísticos de regresión y las pruebas de hipótesis, se puede concluir que los coeficientes del modelo son estadísticamente significativos para el modelo de regresión. Esto implica que las variables independientes correspondientes tienen un efecto significativo en la predicción de la variable dependiente.

Es clave también destacar que el modelo propuesto en este análisis cumple con los supuestos de homocedasticidad, autocorrelación y normalidad en los errores. En primer lugar, la homocedasticidad, que implica que la varianza de los errores es constante en todos los niveles de la variable independiente, se verifica mediante pruebas estadísticas adecuadas, como el test de Breusch-Pagan, que no encontró evidencia significativa de heterocedasticidad en los residuos del modelo. Además, la autocorrelación, que indica la falta de independencia entre los errores, se evaluó a través del test de Durbin-Watson, que no encontró evidencia de autocorrelación en los residuos del modelo. Por último, la normalidad en los errores, que supone que los errores se distribuyen normalmente, se verificó mediante el test de Shapiro-Wilk, que no encontró evidencia significativa de desviación de una distribución normal en los residuos del modelo. Estos resultados indican que el modelo de regresión lineal simple utilizado en este análisis satisface los supuestos fundamentales necesarios para realizar inferencias válidas y confiables sobre la relación entre las variables. Los resultados aquí mencionados se pueden validar en la sección 2.7 del apartado de anexos.

### 1.4. Conclusiones
Este informe contribuye a una mejor comprensión de los factores que determinan el precio de las viviendas en Cali, particularmente en el segmento de estrato 4 con un área construida inferior a 200 metros cuadrados. La identificación de un modelo estadístico que describe la relación entre el precio y el área construida permite a los actores del mercado inmobiliario tomar decisiones más acertadas en sus transacciones

La alta proporción de variabilidad en el precio de una propiedad explicada por el área construida (71.63%) sugiere que el modelo de regresión lineal simple es una herramienta útil para predecir el precio de una propiedad basándose en su área de construcción. Esta relación significativa entre el área construida y el precio proporciona una base sólida para estimar el valor de las propiedades.

El hecho de que los coeficientes del modelo sean estadísticamente significativos implica que el área construida tiene un efecto significativo en la predicción del precio de una propiedad. Esto sugiere que, en promedio, por cada unidad adicional de área construida, el precio de la propiedad aumenta o disminuye de manera significativa. Esta información es crucial para los agentes del mercado inmobiliario y los inversores que deseen comprender cómo varía el precio de una propiedad en función de su tamaño.

Dado que el modelo captura una porción considerable de la variabilidad en el precio de una propiedad y los coeficientes son estadísticamente significativos, puede ser una herramienta valiosa para la toma de decisiones en el mercado inmobiliario. Los agentes del mercado, los tasadores de propiedades y los compradores potenciales pueden utilizar este modelo para estimar el precio de las propiedades y tomar decisiones informadas sobre la compra, venta o valoración de bienes raíces.

\newpage

## 2. Anexos

### 2.1. Filtro a la base de datos (zona norte):

Se procede a realizar un filtro a la base de datos usando la variable `tipo` para verificar las casas y la variable `zona` para identificar las que se encuentran en la Zona Norte. Se hace la visualización de las primeras tres líneas:
```{r}
cond_vector <- (vivienda$tipo == "Casa") & (vivienda$zona == "Zona Norte")
viviendas_norte <- subset(vivienda, cond_vector)
head(viviendas_norte, 3)
```

Así mismo, se realiza la gráfica de los registros con ubicaciones en zona norte, lo que genera como resultado la siguiete imagen, la cual fue realizada utilizando PowerBI:

```{r echo=FALSE}
knitr::include_graphics('Data/distribucion_zona_norte.jpg')
```

Se evidencia que existen varios registros que están por fuera de la zona norte. Como resultado de este hallazgo, se propone elegir puntos estratégicos con base en la observación de la gráfica y el conocimiento de las zonas, para definir límites estrictos y poder tomar la base de datos de una mejor manera.

Así pues, el filtro arbitrario se generará de la siguiente manera:

* Latitudes mayores a 3.46467 (para sur menores a: 3.40282)
* Longitudes mayores a -76.5354 

Para que el nuevo mapa quede de la siguiente manera. Para efectos ilustrativos se están dejando las anteriores categorizaciones de las zonas, aunque para nuestro ejercicio se van a tomar estos puntos como ZONA NORTE:

```{r echo=FALSE}
knitr::include_graphics('Data/distribucion_zona_norte_processed.jpg')
```

 
Por lo tanto, nuestra nueva consulta para trabajo, llamada `viviendas_norte` será la calculada con el siguiente código:


```{r}
cond_vector <- (vivienda$tipo == "Casa") & (vivienda$latitud > 3.46467) & (vivienda$longitud > -76.5354)
viviendas_norte <- subset(vivienda, cond_vector)
cat("Cantidad columnas: ", ncol(viviendas_norte), "Cantidad filas: ", nrow(viviendas_norte))
head(viviendas_norte, 3)
```

Se hace el slice por variables de interés para nuestro ejercicio:

```{r}
interest_cols <- c("preciom", "areaconst", "estrato", "banios", "habitaciones")
viviendas_norte <- viviendas_norte[, interest_cols] 
viviendas_norte
```


### 2.2. Análisis exploratorio:

Análisis exploratorio de datos, enfocado en la relación entre la variable respuesta (precio) en función de las variables predictoras (área construida, estrato, número de cuartos, número de parqueaderos, número de baños)

Boxplot para verificar la relación entre el `estrato` (variable categórica ordinal) y `preciom`:

```{r}

# Se convierte estrato a un factor para evitar que se considere una variable numérica
viviendas_norte$estrato <- factor(viviendas_norte$estrato)

# Create box plot
plot <- plot_ly(viviendas_norte, x = ~estrato, y = ~preciom, type = 'box') %>%
  layout(title = "Precio vs. Estrato")

plot
```



Gráfico de dispersión para visualizar la relación entre el área construida y el precio de la vivienda

```{r}
# Crear un gráfico de dispersión de precio vs. área construida
plot <- plot_ly(viviendas_norte, x = ~areaconst, y = ~preciom,
                type = 'scatter', mode = 'markers',
                marker = list(color = 'blue'))

# Agregar título y etiquetas
plot <- plot %>% layout(title = "Relación entre Precio y Área Construida",
                       xaxis = list(title = "Área Construida"),
                       yaxis = list(title = "Precio"))

plot
```



Matriz de correlación para realizar una visualización de la interacción de las variables con respecto a nuestra variable objetivo (preciom) y entre dependientes:
``` {r}
# Crear una matriz de correlación excluyendo "estrato"
corr_matrix <- cor(viviendas_norte[, -which(names(viviendas_norte) == "estrato")])

# Visualizar la matriz de correlación como un mapa de calor
plot_ly(z = corr_matrix, x = colnames(corr_matrix), y = colnames(corr_matrix),
        type = "heatmap", colorscale = "Inferno") %>%
  layout(title = "Matriz de Correlación")
```

